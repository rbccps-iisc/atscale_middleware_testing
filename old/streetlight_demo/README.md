# A demo for smart streetlights.

To run the demo:

``` console
	$ python3 run_testbench.py
```
A smart streetlight adapts to changes in ambient light and presence/absence of activity. It turns OFF automatically during the daytime and stays dimmed at night when no activity is detected near it, but brightens up when activity is detected in its vicinity. Each streetlight has an LED array with a controllable brightness level and a set of sensors.

##### Each streetlight is assumed to have the following sensors:
 * A sensor to measure the ambient light intensity. The measured intensity is represented as a number between 0 to 1, where 0 and 1 indicate the lowest (dark) and highest (bright) light intensities respectively that can be measured by the sensor.
 * A sensor to measure the intensity of the light generated by streetlight's own LED array. This is also represented by a 
 number between 0 and 1.
 * An activity sensor that generates an interrupt whenever an object (such as a vehicle or a pedestrian) passes across the streetlight.

##### This demo consists of simulation models for:
* individual streetlights,
* an app that monitors the lights,
* a _state injector_ module which injects state/sensor values/faults into streetlight devices at pre-determined times.
This can be used to:
  * inject values into the activity sensors of successive streetlights to model moving vehicles
  * inject identical values into the ambient light sensors of all streetlights to model common environmental conditions
  * inject faults into groups of streetlights to model power outages or sensor failures
  
## Streetlight Behavior:
* Periodically publish sensor data to the middleware.
* Periodically check for, and respond to commands from the middleware.
* Adjust the LED light intensity according to the ambient light level:
  * When ambient light level >= 0.8 (day-time), turn OFF the light.
  * When ambient light level < 0.8, turn ON the light and set brightness level to 0.2 (dim)  
* Whenever the LED light is ON and the activity sensor detects an object:
  * Set brightness level to 1 (max brightness)
  * Inform the neighbouring _N_ streetlights about the activity detected
  * Publish information about the activity detected to the middleware

* When informed by a neighbouring streetlight about activity detected, set the brightness level to 1.
* Whenever the light is ON, but no activity is detected for a certain amount of time, 
dim the light again automatically (set brightness to 0.2).

## App Behavior:
* Monitor the state of all streetlights by collecting sensor data from each light, and plot this data
* If no messages are received from a particular streetlight for a certain amount of time, it is possible that there was a fault in the streetlight, for example, because of power failure. Mark this streetlight as _possibly faulty_.
* For other kinds of faults (for example sensor failure) on the streetlight, the streetlight will publish a _failure_ message. Upon receiving such a message, mark the streetlight as faulty and send appropriate commands to the streetlight for recovery/restart.

## Behavior of the State Injector:
* Periodically inject values for the ambient light sensor into each streetlights to model the passage of the day.
* To model a moving vehicle, inject activities into successive street lights after fixed intervals. The length of the interval is inversely proportional to the vehicle's speed.
* Inject faults randomly into streetlights to model power outage and sensor failures.

